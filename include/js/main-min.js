function buildTipoIluminacao(){for(var e=0;e<tipoInstalacao.length;e++)$("#tipo-iluminacao").append($('<option class="op"> </option>').val(e).html(tipoInstalacao[e].nome));$("#tipo-iluminacao").change(function(){""!=$("#tipo-iluminacao").val()?($("#custo-unit-iluminacao-titulo").show(),$("#custo-unit-iluminacao").show(),$("#custo-unit-iluminacao-titulo-label").show(),$("#custo-unit-iluminacao").val(tipoInstalacao[$("#tipo-iluminacao").val()].custo_unit),$("#iluminacao").show(),tipoInstalacao[$("#tipo-iluminacao").val()].nome==INTERIOR?(estado=INTERIOR,estadoNum=INT,showInterior()):tipoInstalacao[$("#tipo-iluminacao").val()].nome==EXTERIOR&&(estado=EXTERIOR,estadoNum=EXT,showExterior()),buildDadosTable()):($("#iluminacao").hide(),$("#custo-unit-iluminacao").hide(),$("#custo-unit-iluminacao-titulo").hide(),$("#custo-unit-iluminacao-titulo-label").hide())})}function buildDadosTable(){if(espacoCount=0,espacoCount++,tipoInstalacao[$("#tipo-iluminacao").val()].nome==EXTERIOR){estado=EXTERIOR;var e='<table class="table table-bordered" id="dataTable"><tbody><tr style="font-weight:bold;" class="titulo_row"><th class="tituloTH">Espaço</th><th class="tituloTH">Designação</th><th class="tituloTH">&nbsp</th></tr>';e+='<tr class="textTR" name="espaco" id="clone1" hidden>',e+='<td class="in"></td>',e+='<td class="in"><input class="form-control xInput" type="text" placeholder="Designação" id="designacao" name="designacao"></input></td>',e+='<td class="in"><button class="but-dados" type="button" id="remove-espaco" name="remove-espaco" onclick="removeEspaco(this)">Remover</button></td>',e+="</tr>",e+='<tr class="textTR" name="espaco">',e+='<td class="in">'+espacoCount+"</td>",e+='<td class="in"><input class="form-control xInput" type="text" placeholder="Designação" id="designacao'+espacoCount+'" name="designacao'+espacoCount+'"></input></td>',e+='<td class="in"><button class="but-dados" type="button" id="remove-espaco" name="remove-espaco" onclick="removeEspaco(this)">Remover</button></td>',e+="</tr>",e+='<tr class="textTR" name="espaco" id="adiciona-row"><td class="in"></td><td class="in"></td><td class="in"><button class="but-dados" type="button" id="adiciona-espaco" name="adiciona-espaco" onclick="adicionaEspaco()">Adicionar</button></td></tr>'}else if(tipoInstalacao[$("#tipo-iluminacao").val()].nome==INTERIOR){estado=INTERIOR;e='<table class="table table-bordered" id="dataTable"><tbody><tr style="font-weight:bold;" class="titulo_row"><th class="tituloTH">Espaço</th><th class="tituloTH">Tipologia do espaço</th><th class="tituloTH">Designação</th><th class="tituloTH">Área (m2)</th><th class="tituloTH">&nbsp</th></tr>';e+='<tr class="textTR" name="espaco" id="clone1" hidden>',e+='<td class="in"></td>',e+='<td class="select-cell"><select name="tipologia" class="interior" id="tipologia">',e+='<option class="op" value="">Selecionar opção</option>';for(var o=0;o<tipoTipologia.length;o++)e+='<option class="op" value="'+o+'">'+tipoTipologia[o].nome+"</option>";e+="</select></td>",e+='<td class="in"><input class="form-control xInput" type="text" placeholder="Designação" id="designacao" name="designacao"></input></td>',e+='<td class="in"><input class="form-control xInput" type="number" min="1" step="0.1" placeholder="0 m2" class="interior" id="area" name="area"></input></td>',e+='<td class="in"><button class="but-dados" type="button" id="remove-espaco" name="remove-espaco" onclick="removeEspaco(this)">Remover</button></td>',e+="</tr>",e+='<tr class="textTR" name="espaco">',e+='<td class="in">'+espacoCount+"</td>",e+='<td class="select-cell"><select name="tipologia'+espacoCount+'" class="interior" id="tipologia'+espacoCount+'">',e+='<option class="op" value="">Selecionar opção</option>';for(o=0;o<tipoTipologia.length;o++)e+='<option class="op" value="'+o+'">'+tipoTipologia[o].nome+"</option>";e+="</select></td>",e+='<td class="in"><input class="form-control xInput" type="text" placeholder="Designação" id="designacao'+espacoCount+'" name="designacao'+espacoCount+'"></input></td>',e+='<td class="in"><input class="form-control xInput" type="number" min="1" step="0.1" placeholder="0 m2" class="interior" id="area'+espacoCount+'" name="area'+espacoCount+'"></input></td>',e+='<td class="in"><button class="but-dados" type="button" id="remove-espaco" name="remove-espaco" onclick="removeEspaco(this)">Remover</button></td>',e+="</tr>",e+='<tr class="textTR" name="espaco" id="adiciona-row"><td class="in"></td><td class="in"></td><td class="in"></td><td class="in"></td><td class="in"><button class="but-dados" type="button" id="adiciona-espaco" name="adiciona-espaco" onclick="adicionaEspaco()">Adicionar</button></td></tr>',e+="<tr>",e+='<td colspan="3">TOTAL</td>',e+='<td id="total-area">0 m2</td>',e+="<td>&nbsp</td>",e+="</tr>"}$("#espacos-iluminacao").html(e+"</tbody></table>"),$("#tipologia"+espacoCount).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#designacao"+espacoCount).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#area"+espacoCount).rules("add",{required:!0,min:1,number:!0,step:.1,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">A área tem que ser maior que 0</label>',step:'<label style="font-size: 14px; color: red;">O passo de incremento é de 0.1</label>',number:'<label style="font-size: 14px; color: red;">Introduza números com (.) em vez de (,)</label>'}}),$("#area"+espacoCount).change(function(){totalArea()})}function buildFonteLuz(){for(e=1;e<=espacoCount;e++)$("#espaco-fonte-luz"+e).remove();for(e=1;e<=espacoCount;e++)$("#tipo-fonte-luz").find("option").remove().end().append('<option name="tipo-fonte-luz-op" class="op" value="">Selecionar opção</option>').val("");for(var e=0;e<tipoFonteLuz.length;e++)for(var o=0;o<tipoFonteLuz[e].aplicacaoPotencia.length;o++)if(tipoFonteLuz[e].aplicacaoPotencia[o].match(estado)){$("#tipo-fonte-luz").append($('<option name="tipo-fonte-luz-op" class="op"></option>').val(e).html(tipoFonteLuz[e].tipo));break}var t,a=$("#espaco-fonte-luz");for(e=1;e<=espacoCount;e++)espaco[e].id=e,(t=a.clone()).attr("id","espaco-fonte-luz"+e),t.find("td").eq(0).html(e),t.find("td").eq(1).html(espaco[e].designacao),t.find("td").eq(2).find("input").attr("id","quantidade-fonte-luz"+e),t.find("td").eq(2).find("input").attr("name","quantidade-fonte-luz"+e),t.find("td").eq(3).find("select").attr("id","tipo-fonte-luz"+e),t.find("td").eq(3).find("select").attr("name","tipo-fonte-luz"+e),t.find("td").eq(4).find("select").attr("id","potencia-fonte-luz"+e),t.find("td").eq(4).find("select").attr("name","potencia-fonte-luz"+e),t.find("td").eq(5).find("input").attr("id","potencia-fonte-luz-input"+e),t.find("td").eq(5).find("input").attr("name","potencia-fonte-luz-input"+e),t.find("td").eq(6).find("input").attr("id","horas-funcionamento-fonte-luz"+e),t.find("td").eq(6).find("input").attr("name","horas-funcionamento-fonte-luz"+e),t.find("td").eq(7).find("input").attr("id","rendimento-fonte-luz"+e),t.find("td").eq(7).find("input").attr("name","rendimento-fonte-luz"+e),t.insertBefore("#total-fonte-luz-row"),$("#tipo-fonte-luz"+e).change(function(e){var o=$(e.target).parent("td").parent("tr").find("td").eq(4).find("select"),t=$(e.target).parent("td").parent("tr").find("td").eq(5),a=$(e.target).parent("td").parent("tr").find("td").eq(7).find("input");if($(e.target).val()==OUTROS)$(t).change(function(){totalPotenciaFonteLuz()}),$(e.target).parent("td").parent("tr").find(".outro-sel").hide(),t.show(),a.val(""),a.removeAttr("disabled");else if(""!=$(e.target).val()&&$(e.target).val()!=OUTROS){var i=$(e.target).val();$(o).length>0&&($(o).find("option").remove(),$(o).append($('<option value="">Selecionar opção</option>')));for(var n=0;n<tipoFonteLuz[i].aplicacaoPotencia.length;n++)tipoFonteLuz[i].aplicacaoPotencia[n].match(estado)&&$(o).append($('<option class="op"> </option>').val(n).html(tipoFonteLuz[i].potencia[n]));a.val(tipoFonteLuz[$(e.target).val()].rendimento),a.attr("disabled","disabled"),$(e.target).parent("td").parent("tr").find(".outro-sel").show(),t.hide()}else $(o).find("option").remove(),$(o).append($('<option value="">Selecionar opção</option>'))}),$("#quantidade-fonte-luz"+e).change(function(e){totalQtFonteLuz(),totalPotenciaFonteLuz();var o=$(e.target),t=o.parent("td").parent("tr").find("td").eq(6).find("input");estado==EXTERIOR&&o.val()>0?t.val(horasAnuaisFunc):t.val(0)}),$("#quantidade-fonte-luz"+e).rules("add",{required:!0,min:1,number:!0,step:1,digits:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">O valor mínimo é 1</label>',step:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>',number:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>',digits:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>'}}),$("#tipo-fonte-luz"+e).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#potencia-fonte-luz"+e).change(function(){totalPotenciaFonteLuz()}),$("#potencia-fonte-luz"+e).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#potencia-fonte-luz-input"+e).change(function(){totalPotenciaFonteLuz()}),$("#potencia-fonte-luz-input"+e).rules("add",{required:!0,min:1,number:!0,step:1,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">O valor mínimo é 1</label>',step:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>',number:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>'}}),$("#horas-funcionamento-fonte-luz"+e).rules("add",{required:!0,min:1,number:!0,step:1,max:8760,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">O valor mínimo é 1</label>',max:'<label style="font-size: 14px; color: red;">O valor máximo de horas de funcionamento anual é de 8760</label>',step:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>',number:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>'}}),$("#rendimento-fonte-luz"+e).rules("add",{required:!0,min:1,number:!0,step:1,max:120,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">O valor mínimo é 1</label>',max:'<label style="font-size: 14px; color: red;">O rendimento máximo é de 120 lm/W</label>',step:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>',number:'<label style="font-size: 14px; color: red;">Introduza números inteiros</label>'}}),t.show()}function buildMedidas(){for($("#reguladores-fluxo-medidas").find("option:gt(0)").remove(),$("#sensores-medidas").find("option:gt(0)").remove(),$("#sistemas-gestao-medidas").find("option:gt(0)").remove(),$("#fonte-luz-medidas").find("option:gt(0)").remove(),t=1;t<=espacoCount;t++)$("#espaco-medidas"+t).remove();for(var e,o=$("#espaco-medidas"),t=1;t<=espacoCount;t++){(e=o.clone()).attr("id","espaco-medidas"+t),e.find("td").eq(0).html(t),e.find("td").eq(1).html(espaco[t].designacao),e.find("td").eq(2).find("select").attr("id","fonte-luz-medidas"+t),e.find("td").eq(2).find("select").attr("name","fonte-luz-medidas"+t);var a;for(a=tipoFonteLuz[fonteLuz[t].tipo].medidas.split(","),k=0;k<medidas.length;k++){var i=!1;for(h=0;h<a.length;h++)if(""!=a[h]&&null!=a[h]&&a[h]==k){i=!0;break}if(i&&fonteLuz[t].potenciaUnitFinal!=medidas[k].nome)if(medidas[k].nome.search("(AP)")>0||medidas[k].nome.search("(BP)")>0){var n=medidas[k].nome.search("(AP)")>0?medidas[k].nome.search("(AP)"):medidas[k].nome.search("(BP)");e.find("td").eq(2).find("#fonte-luz-medidas"+t).append($('<option class="op"> </option>').val(k).html(medidas[k].nome.substring(0,n-1)+" ("+medidas[k].poupanca+" lm/W)"))}else e.find("td").eq(2).find("#fonte-luz-medidas"+t).append($('<option class="op"> </option>').val(k).html(medidas[k].nome+" ("+medidas[k].poupanca+" lm/W)"))}e.find("td").eq(3).find("select").attr("id","reguladores-fluxo-medidas"+t),e.find("td").eq(3).find("select").attr("name","reguladores-fluxo-medidas"+t),e.find("td").eq(4).find("select").attr("id","sensores-medidas"+t),e.find("td").eq(4).find("select").attr("name","sensores-medidas"+t),e.find("td").eq(5).find("select").attr("id","sistemas-gestao-medidas"+t),e.find("td").eq(5).find("select").attr("name","sistemas-gestao-medidas"+t);for(var s=0;s<tipoMedidas.length;s++)e.find("td").eq(3).find("#reguladores-fluxo-medidas"+t).append($('<option class="op"> </option>').val(s).html(tipoMedidas[s])),e.find("td").eq(4).find("#sensores-medidas"+t).append($('<option class="op"> </option>').val(s).html(tipoMedidas[s])),e.find("td").eq(5).find("#sistemas-gestao-medidas"+t).append($('<option class="op"> </option>').val(s).html(tipoMedidas[s]));e.find("td").eq(3).find("#reguladores-fluxo-medidas"+t).val(1),e.find("td").eq(4).find("#sensores-medidas"+t).val(1),e.find("td").eq(5).find("#sistemas-gestao-medidas"+t).val(1),e.insertBefore("#total-medidas-row"),e.show(),$("#reguladores-fluxo-medidas"+t).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#sensores-medidas"+t).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#sistemas-gestao-medidas"+t).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}})}}function showExterior(){$(".interior").hide(),$(".col-medida").removeAttr('colspan="4"').attr('colspan="3"')}function showInterior(){$(".interior").show()}function removeEspaco(e){$(e).closest("tr").remove(),espacoCount--,totalArea()}function adicionaEspaco(){espacoCount++;var e=$("#clone1").clone();tipoInstalacao[$("#tipo-iluminacao").val()].nome==INTERIOR?(e.attr("id","clone"+espacoCount),e.find("td").eq(0).html(espacoCount),e.find("td").eq(1).find("select").attr("id","tipologia"+espacoCount),e.find("td").eq(1).find("select").attr("name","tipologia"+espacoCount),e.find("td").eq(2).find("input").attr("id","designacao"+espacoCount),e.find("td").eq(2).find("input").attr("name","designacao"+espacoCount),e.find("td").eq(3).find("input").attr("id","area"+espacoCount),e.find("td").eq(3).find("input").attr("name","area"+espacoCount),e.find("td").eq(4).find("button").attr("id","remove-espaco"+espacoCount),e.insertBefore("#adiciona-row"),$("#tipologia"+espacoCount).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#designacao"+espacoCount).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),$("#area"+espacoCount).rules("add",{required:!0,min:1,number:!0,step:.1,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">A área tem que ser maior que 0</label>',step:'<label style="font-size: 14px; color: red;">Introduza um número válido. Ex: 10.0</label>',number:'<label style="font-size: 14px; color: red;">Introduza números com (.) em vez de (,)</label>'}}),e.show(),$("#area"+espacoCount).change(function(){totalArea()})):tipoInstalacao[$("#tipo-iluminacao").val()].nome==EXTERIOR&&(e.attr("id","clone"+espacoCount),e.find("td").eq(0).html(espacoCount),e.find("td").eq(1).find("input").attr("id","designacao"+espacoCount),e.find("td").eq(1).find("input").attr("name","designacao"+espacoCount),e.find("td").eq(2).find("button").attr("id","remove-espaco"+espacoCount),e.insertBefore("#adiciona-row"),$("#designacao"+espacoCount).rules("add",{required:!0,messages:{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'}}),e.show())}function recolheDados(){for(;espaco.length>1;)espaco.pop();for(var e=1;e<=espacoCount;e++)if(estado==INTERIOR){var o=$("#tipologia"+e).val(),t=$("#designacao"+e).val(),a=$("#area"+e).val();espaco.push({id:e,tipologia:o,designacao:t,area:a})}else if(estado==EXTERIOR){t=$("#designacao"+e).val();espaco.push({id:e,designacao:t})}tipoInstalacao[estadoNum].custo_unit=$("#custo-unit-iluminacao").val()}function recolheFonteLuz(){for(;fonteLuz.length>1;)fonteLuz.pop();for(var e=1;e<=espacoCount;e++){var o=$("#espaco-fonte-luz"+e).find("td").eq(1).text(),t=$("#espaco-fonte-luz"+e).find("td").eq(2).find("input").val(),a=$("#espaco-fonte-luz"+e).find("td").eq(7).find("input").val(),i=$("#espaco-fonte-luz"+e).find("td").eq(3).find("select").val(),n=0;if(void 0!==i&&""!==i&&i==OUTROS)n=$("#espaco-fonte-luz"+e).find("td").eq(5).find("input").val();else{if(!(null!=i&&""!==i&&i>=0)){alert("Faltam preencher campos");break}n=tipoFonteLuz[i].potencia[$("#espaco-fonte-luz"+e).find("td").eq(4).find("select").val()]}var s=calculaAP_BP(n,tipoFonteLuz[i].rendimento,tipoFonteLuz[LED].rendimento);s>=25?estadoPotenciaUnitFinal=BP:s<25&&(estadoPotenciaUnitFinal=AP);var l=$("#espaco-fonte-luz"+e).find("td").eq(6).find("input").val();fonteLuz.push({espacoNum:e,designacao:o,quantidade:t,tipo:i,potencia:n,horasFuncionamento:l,potenciaUnitFinal:estadoPotenciaUnitFinal,rendimento:a,medidasUpgrade:tipoFonteLuz[i].medidas})}}function recolheMedidas(){for(document.getElementsByName("espaco-medidas");medidasDados.length>1;)medidasDados.pop();for(var e=1;e<=espacoCount;e++){var o=$("#espaco-medidas"+e).find("td").eq(1).text(),t=$("#espaco-medidas"+e).find("td").eq(2).find("select").val(),a=$("#espaco-medidas"+e).find("td").eq(3).find("select").val(),i=$("#espaco-medidas"+e).find("td").eq(4).find("select").val(),n=$("#espaco-medidas"+e).find("td").eq(5).find("select").val();medidasDados.push({espacoNum:e,designacao:o,fonteLuz:t,reguladoresFluxo:a,sensores:i,sistemaGestao:n})}}function buildResumo(){resumoCenarios=[{nome:"Cenário Inicial",potencia:0,consumoAnual:0,custosEnergeticos:0},{nome:"Cenário Final",potencia:0,consumoAnual:0,custosEnergeticos:0}],resumoGeral={reducaoCustos1:"",reducaoCustos2:"",investimento:"",payback:""},resumoCenarios[0].potencia=cenarioInicial[TOTAL].potencia.toFixed(0),resumoCenarios[0].consumoAnual=cenarioInicial[TOTAL].consumo.toFixed(0),resumoCenarios[0].custosEnergeticos=cenarioInicial[TOTAL].custoEnergia.toFixed(0),resumoCenarios[1].potencia=cenarioFinal[TOTAL].potencia.toFixed(0),resumoCenarios[1].consumoAnual=cenarioFinal[TOTAL].consumoFinal.toFixed(0),resumoCenarios[1].custosEnergeticos=cenarioFinal[TOTAL].custoEnergia.toFixed(0),resumoGeral.reducaoCustos1=investimento[TOTAL].reducaoCustos1.toFixed(0),resumoGeral.reducaoCustos2=isNaN(resumoCenarios[0].custosEnergeticos)?" - ":(resumoGeral.reducaoCustos1/resumoCenarios[0].custosEnergeticos*100).toFixed(0),resumoGeral.investimento=investimento[TOTAL].investimento.toFixed(0),resumoGeral.payback=isNaN(investimento[TOTAL].pri)?" - ":investimento[TOTAL].pri.toFixed(1),$("#potencia-1-resumo").html(resumoCenarios[INICIAL].potencia+" W"),$("#consumo-anual-1-resumo").html(resumoCenarios[INICIAL].consumoAnual+" kWh"),$("#custos-energeticos-1-resumo").html(resumoCenarios[INICIAL].custosEnergeticos+" €"),$("#potencia-2-resumo").html(resumoCenarios[FINAL].potencia+" W"),$("#consumo-anual-2-resumo").html(resumoCenarios[FINAL].consumoAnual+" kWh"),$("#custos-energeticos-2-resumo").html(resumoCenarios[FINAL].custosEnergeticos+" €"),$("#reducao-consumos-1-resumo").html(resumoCenarios[INICIAL].consumoAnual-resumoCenarios[FINAL].consumoAnual+" kWh"),$("#reducao-consumos-2-resumo").html((100*(1-resumoCenarios[FINAL].consumoAnual/resumoCenarios[INICIAL].consumoAnual)).toFixed(0)+"%"),$("#reducao-custos-1-resumo").html(resumoGeral.reducaoCustos1+" €"),$("#reducao-custos-2-resumo").html(resumoGeral.reducaoCustos2+"%"),$("#investimento-resumo").html(resumoGeral.investimento+" €"),resumoGeral.payback<0?$("#payback-resumo").html(" -"):$("#payback-resumo").html(resumoGeral.payback+" anos"),0==$("#tipo-iluminacao").val()?iluIntChart():1==$("#tipo-iluminacao").val()&&iluExtChart()}function maxChart(e){var o=0;if(e.length>0)for(var t=0;t<e.length;t++)(e[t]>o||0==o)&&(o=new Number(e[t]));return o+=.1*o}function iluIntChart(){var e=[],o=[];for(i=1;i<=espacoCount;i++)e[i]=cenarioInicial[i].designacao,o[i]=cenarioInicial[i].consumo,o[i]=new Number(o[i].toFixed(0));e.shift(),o.shift();var t=[];for(i=1;i<=espacoCount;i++)t[i]=cenarioFinal[i].consumoFinal,t[i]=new Number(t[i].toFixed(0));t.shift();var a=maxChart(o)>maxChart(t)?maxChart(o):maxChart(t),n=document.getElementById("iluIntChart");new Chart(n,{type:"bar",data:{labels:e,datasets:[{label:"Cenário Inicial",data:o,backgroundColor:"rgba(53, 91, 183, 1)",borderColor:"rgba(53, 91, 183, 1)",borderWidth:1},{label:"Cenário Final",data:t,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:a,callback:function(e,o,t){return e.toFixed(0)+" kWh"}}}],xAxes:[{ticks:{autoSkip:!1,maxRotation:90,minRotation:90}}]},title:{display:!0,text:"Consumo anual de energia (kWh)",fontSize:16,fontColor:"#0099cc"},legend:{onClick:function(e,o){}}}})}function iluExtChart(){var e,o=[],t=[];for(i=1;i<=espacoCount;i++)o[i]=cenarioInicial[i].designacao,t[i]=cenarioInicial[i].consumo,t[i]=new Number(t[i].toFixed(0));o.shift(),t.shift();var a=[];for(i=1;i<=espacoCount;i++)a[i]=cenarioFinal[i].consumoFinal,a[i]=a[i].toFixed(0);a.shift(),e=maxChart(t)>maxChart(a)?maxChart(t):maxChart(a);var n=document.getElementById("iluIntChart");new Chart(n,{type:"bar",data:{labels:o,datasets:[{label:"Cenário Inicial",data:t,backgroundColor:"rgba(53, 91, 183, 1)",borderColor:"rgba(53, 91, 183, 1)",borderWidth:1},{label:"Cenário Final",data:a,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:e,callback:function(e,o,t){return e.toFixed(0)+" kWh"}}}],xAxes:[{ticks:{autoSkip:!1,maxRotation:90,minRotation:90}}]},title:{display:!0,text:"Consumo anual de energia (kWh)",fontSize:16,fontColor:"#0099cc"},legend:{onClick:function(e,o){}}}})}function nextStep(){var e=$(".step:visible").data("id"),o=$(".step:visible").data("id")+1;$('[data-id="'+e+'"]').hide(),$('[data-id="'+o+'"]').show(),$(".anterior:hidden").length>1&&($(".anterior").show(),$(".custo-iluminacao-box").hide(),$("#tipo-iluminacao").attr("disabled","disabled").addClass("sel-disable"),$("#disclaimer").hide()),2==o&&($(".dados-titulo").hide(),$(".but-2").hide(),$(".recolhe-medidas-but").show(),$(".end-step").hide(),$("#disclaimer").hide()),3==o&&($(".but-2").hide(),$(".recolhe-medidas-but").hide(),$(".end-step").show(),$(".print_pdf").hide(),$("#disclaimer").hide()),4==o&&($(".but-2").hide(),$(".recolhe-medidas-but").hide(),$(".end-step").show(),$("#reload-but").show(),$(".print_pdf").show(),$(".resumo-but").hide(),$("#disclaimer").show()),location.hash="html"}function prevStep(){var e=$(".step:visible").data("id"),o=$(".step:visible").data("id")-1;$('[data-id="'+e+'"]').hide(),$('[data-id="'+o+'"]').show(),1==o&&($(".dados-titulo").show(),$(".but-2").show(),$(".recolhe-medidas-but").hide(),$(".end-step").hide(),$(".anterior").hide(),$(".custo-iluminacao-box").show(),$("#tipo-iluminacao").removeAttr("disabled","disabled").removeClass("sel-disable"),$("#disclaimer").hide()),2==o&&($(".but-2").hide(),$(".recolhe-medidas-but").show(),$(".end-step").hide(),$("#disclaimer").hide()),3==o&&($(".final-graph #iluIntChart").remove(),$(".final-graph").append('<canvas id="iluIntChart" width="400" height="400"></canvas>'),$(".but-2").hide(),$(".recolhe-medidas-but").hide(),$(".end-step").show(),$("#reload-but").hide(),$(".print_pdf").hide(),$(".resumo-but").show(),$("#disclaimer").hide()),location.hash="html"}function printCanvas(){html2canvas(document.body).then(function(e){document.body.appendChild(e)})}$(document).ready(function(){buildTipoIluminacao(),$("#reload-but").click(function(){location.reload()}),$("#tipo-iluminacao").change(function(){0==$("#tipo-iluminacao").val()&&""!=$("#tipo-iluminacao").val()?($("#exterior-ilu").hide(),$("#interior-ilu").show()):1==$("#tipo-iluminacao").val()&&""!=$("#tipo-iluminacao").val()&&($("#exterior-ilu").show(),$("#interior-ilu").hide())}),$("#ilu-form").validate({rules:{"tipo-iluminacao":{required:!0},"custo-unit-iluminacao":{required:!0,min:.01,max:1,step:1e-4}},messages:{"tipo-iluminacao":{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>'},"custo-unit-iluminacao":{required:'<label style="font-size: 14px; color: red;">Este campo é obrigatório.</label>',min:'<label style="font-size: 14px; color: red;">O custo unitário mínimo é de 0.01€/kWh</label>',max:'<label style="font-size: 14px; color: red;">O custo unitário máximo é de 1,00€/kWh</label>',step:'<label style="font-size: 14px; color: red;">O passo de incremento é de 0.0001</label>',number:'<label style="font-size: 14px; color: red;">Introduza números com (.) em vez de (,)</label>'}}}),$(".fonte-luz-but").click(function(){""==$("#tipo-iluminacao").val()||null==$("#tipo-iluminacao").val()?alert("Não é possível avançar sem selecionar o tipo de iluminação."):espacoCount<=0?alert("Não é possível avançar sem espaços definidos."):$("#ilu-form").valid()&&espacoCount>0&&(recolheDados(),nextStep(),buildFonteLuz())}),$(".medidas-but").click(function(){$("#ilu-form").valid()&&(recolheFonteLuz(),nextStep(),firstTimeMedidas=!1,buildMedidas(),calculaCenarioInicial())}),$(".resumo-but").click(function(){$("#ilu-form").valid()&&(recolheMedidas(),nextStep(),calculaCenarioFinal(),calculaInvestimento(),buildResumo())})});